# grouping-tool
オブジェクト指向言語のSA/TAで使うグループ分け用ツール

## 概要
学籍番号を入力して学生を自動的にグループ分けするRust製のコマンドラインツールです。
基本的に3人グループを作成しますが、人数が3で割り切れない場合は2人グループも許可します。

## 機能
1. 1グループ3人として、学籍番号を入力する
2. EOFが入力された場合は、その時点の人数でグループを保存する
3. すでに3人のメンバーがいるグループはそのまま維持する
4. 3人未満のグループのメンバーをランダムに結合し、新しい3人グループを作成する
5. 合計人数が3で割り切れない場合は、2人グループも作成する
6. **NEW:** 1人グループは作成しません（必ず2人以上のグループを作成）
7. **NEW:** 入力間違いの学籍番号を削除できます
8. **NEW:** バッチ処理モード - パイプ/リダイレクト入力時、空行でグループを区切れます

## 重要なルール
- **1人グループは作らない**: グループ分けの際、必ず各グループに最低2人が含まれるようにします
- **グループサイズは2人または3人**: 4人以上のグループは作らず、2人または3人のグループを作成します
  - 4人の場合: 2人+2人のグループに分割
  - 7人の場合: 3人+2人+2人のグループに分割
  - 10人の場合: 3人+3人+2人+2人のグループに分割
  - 13人の場合: 3人+3人+3人+2人+2人のグループに分割
- **削除機能**: 入力ミスがあった場合、`delete:学籍番号` と入力することで削除可能
- **バッチ処理モード**: パイプやリダイレクトで入力する場合、空行でグループを区切ることができます。グループ構成は空行で定義された通りに保持されます（1人グループは自動的に前のグループにマージ）

## システム要件
- Rust 1.70以上
- Cargo

## インストール

### リポジトリからビルド
```bash
git clone https://github.com/maysay-D/grouping-tool.git
cd grouping-tool
cargo build --release
```

## 使い方

### 実行
```bash
cargo run
```

または、ビルド後の実行ファイルを直接実行：
```bash
./target/release/grouping-tool
```

### 入力方法
1. プログラムを起動すると、学籍番号の入力を促すメッセージが表示されます
2. 学籍番号を1行ずつ入力します
3. 入力間違いがあった場合は、`delete:学籍番号` の形式で削除できます（例: `delete:S001`）
4. 入力を終了するには、以下のキーを押します：
   - **Unix/Mac**: 
     - `Ctrl+D` - 現在のグループの入力を終了して次のグループへ進む（対話モードのみ）
     - `Ctrl+C` - プログラムを終了
   - **Windows**: 
     - `Ctrl+Z` その後 `Enter` - 現在のグループの入力を終了
     - `Ctrl+C` - プログラムを終了

**注意**: パイプ入力やリダイレクト入力を使用する場合、EOF（入力の終端）ですべての入力が終了します。Ctrl+Dで複数グループを順次入力する機能は、対話モード（ターミナルから直接実行）でのみ利用可能です。

### 削除機能の使い方
入力ミスをした場合、`delete:学籍番号` と入力することで削除できます：
```bash
S001
S002
delete:S001  # S001を削除
S003
```
削除は現在入力中のグループと、既に完成したグループの両方から可能です。

### 使用例

#### 例1: 9人の学生（3グループに分割）
```bash
$ echo -e "S001\nS002\nS003\nS004\nS005\nS006\nS007\nS008\nS009" | cargo run --quiet

=== グループ分け結果 ===
グループ 1: 3 人
  - S001
  - S002
  - S003
グループ 2: 3 人
  - S004
  - S005
  - S006
グループ 3: 3 人
  - S007
  - S008
  - S009

合計: 3 グループ
```

#### 例2: 5人の学生（1つの3人グループと1つの2人グループ）
```bash
$ echo -e "S001\nS002\nS003\nS004\nS005" | cargo run --quiet

=== グループ分け結果 ===
グループ 1: 3 人
  - S001
  - S002
  - S003
グループ 2: 2 人
  - S004
  - S005

合計: 2 グループ
```

#### 例3: 4人の学生（1人グループを作らない + 4人グループも作らない）
```bash
$ echo -e "S001\nS002\nS003\nS004" | cargo run --quiet

=== グループ分け結果 ===
グループ A: 2 人
  - S001
  - S002
グループ B: 2 人
  - S003
  - S004

合計: 2 グループ
```
**注**: 4人の場合、2人+2人に分割します（3人+1人や4人グループは作りません）

#### 例4: 削除機能の使用
```bash
$ cargo run
学籍番号を入力してください (3人ごとにグループになります):
  - Ctrl+D (Unix/Mac) または Ctrl+Z+Enter (Windows): 現在のグループを終了して次のグループへ
  - Ctrl+C: プログラムを終了
  - 'delete:学籍番号' と入力すると、その学籍番号を削除できます（例: delete:S001）

=== グループ A の入力 ===
S001
  追加: S001
S002
  追加: S002
delete:S001
  ✓ 削除しました: S001 (現在のグループから)
S003
  追加: S003
S004
  追加: S004
  ✓ グループ A が完成しました (3人)
```

#### 例5: バッチ処理モード（空行でグループ区切り）
テキストファイルやパイプ入力で空行を使ってグループを区切ることができます：

```bash
$ cat input.txt
2xJ5-xxx
2yJ5-yyy
2zJ5-zzz

2aJ5-aaa
2bJ5-bbb

2wJ5-www

$ cat input.txt | cargo run --quiet

=== グループ分け結果 ===
グループ A: 3 人
  - 2xJ5-xxx
  - 2yJ5-yyy
  - 2zJ5-zzz
グループ B: 3 人
  - 2aJ5-aaa
  - 2bJ5-bbb
  - 2wJ5-www

合計: 2 グループ
```
**注**: バッチ処理モードでは、空行で区切られたグループ構成がそのまま保持されます。1人グループは自動的に直前のグループにマージされます。

## テスト

ユニットテストを実行：
```bash
cargo test
```

テストカバレッジ：
- グループ作成の基本機能
- 完全なグループの保持
- 不完全なグループの再編成
- 2人グループの許可
- 完全グループと不完全グループの混在
- **NEW:** 1人グループを作らないルールの検証
- **NEW:** 様々な人数での単独グループ回避のテスト
- **NEW:** バッチ処理モードでのグループ保持
- **NEW:** バッチ処理モードでのシングルトンマージ

## ライセンス
このプロジェクトはMITライセンスの下で公開されています。詳細は[LICENSE](LICENSE)ファイルを参照してください。

## 技術スタック
- **言語**: Rust
- **依存関係**: 
  - `rand` 0.8 - ランダムシャッフル機能用
- **対応プラットフォーム**: Windows, macOS, Linux
